function authRequired() {
  try {
    if (db.serverCmdLineOpts().code == 13) {
      return true;
    }
    return false;
  }
  catch (err) {
    return false;
  }
}

if (authRequired()) {
  try {
    db.auth('<%= @admin_username %>', '<%= @admin_password %>');
  }
  catch (err) {
    // This isn't catching authentication errors as I'd expect...
    return;
  }
}
